@page "/Manage-volunteers"

@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.EntityFrameworkCore
@using No_Kill_Inventory.Data
@using OfficeOpenXml
@inject ApplicationDbContext Context
@inject IHostEnvironment HostEnvironment
@rendermode InteractiveServer

@attribute [Authorize]

<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f6f9;
        color: #333;
        margin: 0;
        padding: 0;
    }

    h1, h2 {
        text-align: center;
        color: #2c3e50;
    }

    .container {
        max-width: 800px;
        margin: 20px auto;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    table {
        border-collapse: collapse;
        width: 100%;
        margin: 20px 0;
    }

    th, td {
        border: 1px solid #ddd;
        text-align: left;
        padding: 12px;
    }

    th {
        background-color: #34495e;
        color: #fff;
    }

    tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    button {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
    }

    button:hover {
        background-color: #2980b9;
    }

    button:disabled {
        background-color: #bdc3c7;
        cursor: not-allowed;
    }

    .table-container {
        overflow-x: auto;
    }
</style>

<PageTitle>Manage Volunteers</PageTitle>

<AuthorizeView>
<div class="container" style="margin-top: 20px !important; max-width: 1000px; margin: auto; font-family: Arial, sans-serif;">
    <h1 style="text-align: center; color: #333;">Volunteers</h1>
    <div style="margin-top: 20px; overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; text-align: center;">
            <thead style="background-color: #f2f2f2;">
                <tr>
                    <th>Volunteer ID</th>
                    <th>Name</th>
                    <th>Available</th>
                    <th>Check-In Time</th>
                    <th>Total Minutes</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var volunteer in allVolunteers)
                {
                    <tr>
                        <td>@volunteer.VolunteerID</td>
                        <td>@volunteer.Name</td>
                        <td>@(volunteer.IsAvailable ? "Yes" : "No")</td>
                        <td>@(volunteer.CheckInTime?.ToString("g") ?? "-")</td>
                        <td>@volunteer.TotalMinutes.ToString("0.##")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>



</AuthorizeView>

@code {
    private int volunteersCount;
    private List<Recipient> recipients = new List<Recipient>();

    private string volunteerName = string.Empty;
    private List<Volunteer> availableVolunteers = new List<Volunteer>();

    private string recipientItemsReceivingToShow;

    private List<Volunteer> allVolunteers = new List<Volunteer>();

    private async Task LoadAllVolunteers()
    {
        allVolunteers = await Context.Volunteers.ToListAsync();
    }

    protected override async Task OnInitializedAsync()
    {
        // Load available volunteers
        availableVolunteers = await Context.Volunteers.Where(v => v.IsAvailable).ToListAsync();
        volunteersCount = availableVolunteers.Count;
        // Load recipients from the database
        await LoadRecipientsFromDatabase();
        allVolunteers = await Context.Volunteers.ToListAsync();
    }

        private async Task LoadRecipientsFromDatabase()
        {
            recipients = await Context.Recipients.ToListAsync();
        }


        private async Task AddVolunteer()
        {
            var volunteer = new Volunteer
            {
                Name = "Volunteer " + (volunteersCount + 1),
                IsAvailable = true
            };

            Context.Volunteers.Add(volunteer);
            await Context.SaveChangesAsync();

            volunteersCount++;
        }

}
